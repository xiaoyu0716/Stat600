"0","library(dplyr)"
"0","# library(ggplot2)"
"0",""
"0","# 假设你的训练集为 train_data，测试集为 q1_test"
"0","q2_test <- q2_test[complete.cases(q2_test), ]"
"0","factor_design <-  q2_test %>% select(-depressed) %>% names()"
"0","#   "
"0","# predictors <- names(q2_test)[names(q2_test) != ""depressed""]"
"0","# 创建公式，包括所有两两交叉项"
"0","formula <- as.formula(paste(""~ ("", paste(factor_design, collapse = "" + ""), "")^2""))"
"0","# 生成设计矩阵，自动处理因子变量和交叉项"
"0","design_matrix <- model.matrix(formula, data = q2_test)[, -1]  # 去掉截距列"
"0",""
"0","# 转换为数据框"
"0","design_df <- as.data.frame(design_matrix)"
"0",""
"0","# 使用 model.matrix 生成训练集的哑变量"
"0","# x_train <- model.matrix(~ DBQ700 + DBQ197, data = train_data)[, -1]  # 去掉截距"
"0",""
"0","# 使用 model.matrix 生成测试集的哑变量"
"0","x_test <- model.matrix(~ DBQ700 + DBQ197 -1, data = q1_test)[,-1]  # 注意：不需要包含响应变量"
"0",""
"0",""
"0","# 加载必要的包"
"0","library(glmnet)"
"0",""
"0","# 假设你已经训练了 lasso_model，使用 x_train 和 y_train"
"0","# 例如："
"0","# lasso_model <- cv.glmnet(x_train, y_train, alpha = 1, family = ""binomial"")"
"0",""
"0","# 预测概率"
"0","pred_probs_G <- predict.glm(step_model_2,newdata = q2_test,type = ""response"")"
"0","pred_probs_L <- predict(cv_lasso_2, newx = design_matrix, type = ""response"")"
"0","pred_probs_R <- predict(ridge_model_2, newx = design_matrix, type = ""response"")"
"0","correct_ratio_2 <- array(dim = 3,dimnames = list(c(""step"",""lasso"",""ridge"")))"
"0","# 将预测概率转换为类别"
"0","threshold <- 0.2"
"0",""
"0","pred_classes_G <- ifelse(pred_probs_G > threshold, 1, 0)"
"0","correct_ratio_2[1] <- sum(abs(pred_classes_G-(as.numeric(q2_test$depressed))))/length(pred_classes_G)"
"0","pred_classes_L <- ifelse(pred_probs_L > threshold, 1, 0)"
"0","correct_ratio_2[2] <- sum(abs(pred_classes_L-(as.numeric(q2_test$depressed))))/length(pred_classes_L)"
"0",""
"0","pred_classes_R <- ifelse(pred_probs_R > threshold, 1, 0)"
"0","correct_ratio_2[3] <- sum(abs(pred_classes_R-(as.numeric(q2_test$depressed))))/length(pred_classes_R)"
"0",""
"0","print(correct_ratio_2)"
"1","     step "
"1","    lasso "
"1","    ridge "
"1","
"
"1","0.1028037 "
"1","0.1028037 "
"1","0.1028037 "
"1","
"
